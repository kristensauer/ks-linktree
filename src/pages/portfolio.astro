---
import Layout from "@layouts/Layout.astro";
import Nav from "@components/Nav.astro";
import Carousel from "@components/Carousel.astro";
---

<Layout title="Portfolio">
    <Nav />
    <section id="portfolio" class="portfolio-section">
        <div class="container">
            <h2>Portfolio</h2>
            <p>Scroll to snap between items. Replace the placeholders with your images.</p>
        </div>
        <Carousel />
</Layout>
<style>
.card {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.6s ease;
}

.card.show {
  opacity: 1;
  transform: translateY(0);
}

#particle-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 0;
  pointer-events: none;
}

.portfolio-section {
  position: relative;
  z-index: 1;
}
</style>

<script>
  const canvas = document.getElementById("particle-canvas") as HTMLCanvasElement;
  if (canvas) {
    const ctx = canvas.getContext("2d");
    if (ctx) {
      let particles: any[] = [];
      const particleCount = 60;
      const maxSpeed = 0.5;
      const lineDistance = 130;

      function resizeCanvas() {
        if (!canvas) return;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function Particle(this: any) {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.vx = (Math.random() - 0.5) * maxSpeed;
        this.vy = (Math.random() - 0.5) * maxSpeed;
        this.size = Math.random() * 15 + 10;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.02;
        this.opacity = Math.random() * 0.4 + 0.3;
      }

      Particle.prototype.update = function () {
        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotationSpeed;

        if (this.x < -this.size || this.x > canvas.width + this.size) this.vx *= -1;
        if (this.y < -this.size || this.y > canvas.height + this.size) this.vy *= -1;
      };

      Particle.prototype.draw = function () {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.fillStyle = `rgba(255,255,255,${this.opacity})`;
        
        // Draw star shape
        ctx.beginPath();
        for (let i = 0; i < 5; i++) {
          const angle = (i * 4 * Math.PI) / 5;
          const radius = i % 2 === 0 ? this.size : this.size / 2.5;
          const x = Math.cos(angle) * radius;
          const y = Math.sin(angle) * radius;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      };

      for (let i = 0; i < particleCount; i++) {
        particles.push(new (Particle as any)());
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particles.forEach(p => {
          p.update();
          p.draw();
        });

        requestAnimationFrame(animate);
      }

      animate();
    }
  }
</script>
